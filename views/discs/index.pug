extends ../layout

block content
  .discs
    h1 Mis Discos
    if discs.length
      form(method="get" action="/discs/compare" id="compareForm")
        .grid
          each d in discs
            .card
              .top
                label.chk
                  input(type="checkbox" name="ids" value=d.id)
                  span Comparar
              .main
                .img
                  if d.image
                    img(src=`/images/${d.image}` alt=d.model)
                  else
                    .ph-img
                .info
                  h3= d.model
                  .meta #{d.brand} • #{d.plastic || '—'} • #{d.weight || '—'}g
                  if d.flight
                    .flight #{d.flight.speed || '–'} | #{d.flight.glide || '–'} | #{d.flight.turn || '–'} | #{d.flight.fade || '–'}
              .stats
                .row
                  .label Total
                  .val #{d.stats.total.pct}% (#{d.stats.total.h}/#{d.stats.total.a})
                .row
                  .label C1
                  .val #{d.stats.c1.pct}% (#{d.stats.c1.h}/#{d.stats.c1.a})
                .row
                  .label C2
                  .val #{d.stats.c2.pct}% (#{d.stats.c2.h}/#{d.stats.c2.a})
        .actions
          button.btn(type="submit" id="btnCompare" disabled) Comparar seleccionados
    else
      p No tienes discos todavía.
  
  script.
    (function(){
      const form = document.getElementById('compareForm');
      if(!form) return;
      const btn = document.getElementById('btnCompare');
      const onChange = () => {
        const checked = form.querySelectorAll('input[type="checkbox"]:checked').length;
        btn.disabled = checked < 2; // mínimo 2 para comparar
        btn.textContent = checked ? `Comparar (${checked})` : 'Comparar seleccionados';
      };
      form.addEventListener('change', onChange);
      onChange();
    })();
