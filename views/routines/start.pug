extends ../layout

block content
  .routine-form
    .header.form-header
      a.close(href="/routines" aria-label="Cerrar")
        i.fa-solid.fa-xmark
      h1 Iniciar rutina #{routine.name}
    if !mode
      .mode-tabs
        .tab-buttons
          button.tab-btn.active(type='button' data-tab='individual') Putts individuales
          button.tab-btn(type='button' data-tab='total') Putts totales
        form#individualForm(action=`/routines/${routine.id}/start` method='get')
          input(type='hidden' name='mode' value='individual')
          p Selecciona discos a usar:
          .disc-selects
            .group
              select(name='discIds' required)
                each disc in discs
                  option(value=disc.id) #{disc.brand} #{disc.model}
          button#addDisc(type='button' class='add-disc') + Añadir disco
          button.btn.btn-primary(type='submit') Iniciar rutina
        form#totalForm.hidden(action=`/routines/${routine.id}/start` method='get')
          input(type='hidden' name='mode' value='total')
          .group
            label(for='totalDiscs') Total de discos por estación
            input#totalDiscs(type='number' name='totalDiscs' min='1' value='1' required)
          button.btn.btn-primary(type='submit') Iniciar rutina
        script.
          (function(){
            const tabs=document.querySelectorAll('.tab-btn');
            const individualForm=document.getElementById('individualForm');
            const totalForm=document.getElementById('totalForm');
            tabs.forEach(btn=>btn.addEventListener('click',()=>{
              tabs.forEach(b=>b.classList.remove('active'));
              btn.classList.add('active');
              if(btn.dataset.tab==='individual'){
                individualForm.classList.remove('hidden');
                totalForm.classList.add('hidden');
              } else {
                totalForm.classList.remove('hidden');
                individualForm.classList.add('hidden');
              }
            }));
            const addBtn=document.getElementById('addDisc');
            if(addBtn){
              addBtn.addEventListener('click',()=>{
                const container=document.querySelector('.disc-selects');
                const first=container.querySelector('.group');
                const clone=first.cloneNode(true);
                container.appendChild(clone);
              });
            }
          })();
    else if mode=='individual'
      form(action=`/routines/${routine.id}/complete?mode=individual` method='post')
        each disc in discs
          div
            input(type='hidden' name='discIds' value=disc.id)
            label #{disc.brand} #{disc.model}
            br
            |  C1 intentos:
            input(type='number' name=`attc1_${disc.id}` min='0' value='0')
            |  C1 aciertos:
            input(type='number' name=`hitc1_${disc.id}` min='0' value='0')
            br
            |  C2 intentos:
            input(type='number' name=`attc2_${disc.id}` min='0' value='0')
            |  C2 aciertos:
            input(type='number' name=`hitc2_${disc.id}` min='0' value='0')
        button.btn.btn-primary(type='submit') Guardar resultados
    else if mode=='total'
      form(action=`/routines/${routine.id}/complete?mode=total` method='post')
        each station, i in routine.stations
          div
            label Estación #{i+1} (#{station} m)
            |  Putts:
            input(type='number' name=`attempts_${i}` min='0' value=totalDiscs || 0)
            |  Aciertos:
            input(type='number' name=`hits_${i}` min='0' value='0')
        button.btn.btn-primary(type='submit') Guardar resultados
    .bottom-nav
      a.nav-item(class=activeTab==='home' ? 'active' : '', href="/")
        i.fa-solid.fa-house
        span Inicio
      a.nav-item(class=activeTab==='discs' ? 'active' : '', href="/discs")
        i.fa-solid.fa-compact-disc
        span Discos
      a.play(href="/session" aria-label="Iniciar sesión")
        i.fa-solid.fa-bullseye
      a.nav-item(class=activeTab==='routines' ? 'active' : '', href="/routines")
        i.fa-solid.fa-list-check
        span Rutinas
      a.nav-item(class=activeTab==='you' ? 'active' : '', href="/you")
        i.fa-solid.fa-user
        span Tú
