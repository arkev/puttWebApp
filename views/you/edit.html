<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="PuttLab"><meta name="theme-color" content="#0f131a"><title>PuttLab</title><!-- Font Awesome--><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><!-- Tu CSS compilado por less-middleware--><link rel="stylesheet" href="/css/style.css"><!-- Favicon--><link rel="icon" type="image/png" href="/images/favicon.png"><!-- iOS home screen icon--><link rel="apple-touch-icon" href="/images/favicon.png"><!-- PWA Manifest--><link rel="manifest" href="/manifest.webmanifest"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css"></head><body><div class="auth"><div class="card-auth"><div class="header form-header"><a class="close" href="/you" aria-label="Cerrar"><i class="fa-solid fa-xmark"></i></a><h1>Editar perfil</h1></div><form method="post" action="/you/edit" enctype="multipart/form-data"><div class="group"><label for="username">Usuario</label><input type="text" id="username" name="username" required></div><div class="group"><label for="email">Email</label><input type="email" id="email" name="email" required></div><div class="group"><label for="password">Nueva contraseña (opcional)</label><input type="password" id="password" name="password" minlength="6" placeholder="Dejar vacía para no cambiar"></div><div class="group"><label for="confirm">Confirmar nueva contraseña</label><input type="password" id="confirm" name="confirm" minlength="6"></div><div class="checklist"><div class="item" data-rule="len">Mínimo 6 caracteres</div><div class="item" data-rule="upper">Al menos 1 mayúscula</div><div class="item" data-rule="num">Al menos 1 número</div></div><div class="group"><label for="avatar">Avatar (opcional)</label><input type="file" id="avatar" name="avatar" accept="image/*"><div class="crop-container" id="avatarCropContainer"><div class="crop-header">Ajustar</div><div class="crop-area"><img id="avatarCropImage"></div><div class="crop-actions"><button type="button" id="avatarCropCancel">Cancelar</button><button type="button" id="avatarCropSave">Guardar</button></div></div></div><div class="actions"><button class="btn" type="submit" id="btnSave" disabled>Guardar cambios</button></div></form><!-- Cerrar sesión--><div class="actions"><a class="btn btn-danger" href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión</a></div></div></div><!-- Fuerza navegación in-app cuando está instalada como PWA en iOS--><script>(function(){
  var isStandalone = (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone;
  if(!isStandalone) return;
  // Interceptar target _blank y window.open para mantener navegación interna
  document.addEventListener('click', function(e){
    var a = e.target.closest && e.target.closest('a');
    if(!a) return;
    var href = a.getAttribute('href');
    if(!href) return;
    try {
      var u = new URL(href, location.href);
      if(u.origin === location.origin) {
        a.setAttribute('target','_self');
      }
    } catch(_) {}
  }, true);
  var _open = window.open;
  window.open = function(url, name, specs){
    try{
      var u = new URL(url, location.href);
      if(u.origin === location.origin){ location.href = u.href; return null; }
    }catch(_){ }
    return _open.apply(window, arguments);
  };
})();</script><script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script><script>(function(){
  var pwd = document.getElementById('password');
  var confirm = document.getElementById('confirm');
  var btn = document.getElementById('btnSave');
  function validate(){
    var v = pwd.value || '';
    if(!v){ btn.disabled = false; mark('len', false); mark('upper', false); mark('num', false); return; }
    var okLen = v.length >= 6;
    var okUpper = /[A-Z]/.test(v);
    var okNum = /\d/.test(v);
    var okConfirm = confirm.value && (confirm.value === v);
    mark('len', okLen); mark('upper', okUpper); mark('num', okNum);
    btn.disabled = !(okLen && okUpper && okNum && okConfirm);
  }
  function mark(rule, ok){
    var el = document.querySelector('.checklist .item[data-rule="'+rule+'"]');
    if(!el) return; el.classList.toggle('ok', !!ok);
  }
  ['input','keyup','change'].forEach(ev=>{ pwd.addEventListener(ev, validate); confirm.addEventListener(ev, validate); });
  validate();
})();</script><script>(function(){
  var input = document.getElementById('avatar');
  var container = document.getElementById('avatarCropContainer');
  var img = document.getElementById('avatarCropImage');
  var cancel = document.getElementById('avatarCropCancel');
  var save = document.getElementById('avatarCropSave');
  var cropper;
  if(!input) return;
  input.addEventListener('change', function(e){
    var file = e.target.files && e.target.files[0];
    if(!file) return;
    var reader = new FileReader();
    reader.onload = function(){
      img.src = reader.result;
      container.classList.add('show');
      cropper = new Cropper(img, { aspectRatio: 1, viewMode: 1 });
    };
    reader.readAsDataURL(file);
  });
  cancel && cancel.addEventListener('click', function(){
    container.classList.remove('show');
    if(cropper){ cropper.destroy(); cropper = null; }
    input.value = '';
  });
  save && save.addEventListener('click', function(){
    if(!cropper) return;
    var canvas = cropper.getCroppedCanvas({ width: 400, height: 400 });
    canvas.toBlob(function(blob){
      var orig = input.files && input.files[0];
      var name = (orig && orig.name) || 'avatar.png';
      var type = (orig && orig.type) || 'image/png';
      var file = new File([blob], name, { type: type });
      var dt = new DataTransfer();
      dt.items.add(file);
      input.files = dt.files;
      container.classList.remove('show');
      cropper.destroy();
      cropper = null;
    }, (input.files && input.files[0] && input.files[0].type) || 'image/png');
  });
})();</script></body></html>